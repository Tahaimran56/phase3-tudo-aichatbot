<!--
================================================================================
SYNC IMPACT REPORT
================================================================================
Version change: 1.0.0 → 2.0.0 (MAJOR - Phase 2 web architecture expansion)

Modified principles:
- II. SDD Strictness → Enhanced with Zero Manual Coding + Atomic Commits
- Technical Standards → Expanded from in-memory to Neon Postgres + ORM
- UI/UX Standards → Expanded from CLI to Mobile-First Web + Tailwind CSS

Added sections:
- Web Development Principles (3 principles: Multi-User Isolation, Responsive Design, RESTful Integrity)
- VII. Database Safety (Neon Postgres + ORM)
- VIII. Authentication (Better Auth)
- IX. API Documentation (FastAPI Swagger)

Removed sections:
- None (Phase 1 principles retained for backwards compatibility)

Templates requiring updates:
- ⚠ plan-template.md - May need web-specific project structure options
- ⚠ spec-template.md - May need multi-user scenarios template
- ⚠ tasks-template.md - May need frontend/backend task phases
- ✅ phr-template.prompt.md - No changes needed

Follow-up TODOs:
- Create Phase 2 feature spec for web migration
- Update plan-template.md with web app structure
================================================================================
-->

# The Evolution of Todo Constitution

## Core Principles

### I. Architectural Integrity

Every feature MUST begin with a Specification and a Technical Plan before any implementation work begins.

**Non-Negotiable Rules**:
- No code changes without an approved specification (`spec.md`)
- No implementation without a technical plan (`plan.md`)
- Design artifacts MUST be reviewed and approved before task generation

**Rationale**: Ensures deliberate design decisions and prevents ad-hoc development that leads to technical debt.

### II. SDD Strictness

All implementation MUST be generated by the AI agent based on approved tasks. Zero manual coding outside of the SDD workflow.

**Non-Negotiable Rules**:
- Tasks MUST be defined in `tasks.md` before implementation
- Implementation follows Red-Green-Refactor cycle when tests are specified
- Code changes MUST trace back to approved tasks
- All web components and API routes MUST be generated by the AI agent based on specifications
- Atomic Commits: Commit code only after a single task from `tasks.md` is completed and verified

**Rationale**: Maintains traceability between requirements and implementation; ensures consistency and repeatability.

### III. Language Standard

Code MUST follow established language standards for each technology layer.

**Non-Negotiable Rules**:
- Python 3.12+ with PEP 8 compliance for backend
- Modern Python features (type hints, dataclasses, pattern matching) SHOULD be used
- TypeScript/JavaScript follows ESLint standards for frontend (when applicable)

**Rationale**: Ensures code consistency, readability, and access to modern language features.

### IV. Modularity

Code MUST be organized into clear, testable functions or classes.

**Non-Negotiable Rules**:
- Single Responsibility Principle: each function/class has one clear purpose
- Functions MUST be independently testable
- Avoid deep nesting; prefer composition over inheritance

**Rationale**: Enables unit testing, code reuse, and maintainability.

### V. Type Safety

All functions MUST include type hints or type annotations.

**Non-Negotiable Rules**:
- All function parameters MUST have type annotations
- All function return types MUST be annotated
- Complex types SHOULD use appropriate typing constructs
- API request/response schemas MUST be typed

**Rationale**: Improves code clarity, enables static analysis, and catches errors early.

### VI. Documentation

Every module MUST have documentation explaining its purpose.

**Non-Negotiable Rules**:
- Module-level docstrings are mandatory
- Public functions MUST have docstrings with parameter descriptions
- Classes MUST have docstrings explaining their responsibility
- API endpoints MUST be self-documenting (e.g., FastAPI's Swagger)

**Rationale**: Ensures code is self-documenting and maintainable by future developers (human or AI).

## Web Development Principles

### VII. Multi-User Isolation

Data MUST be strictly isolated by user ID. No user should ever access another user's tasks.

**Non-Negotiable Rules**:
- All database queries MUST filter by authenticated user ID
- API endpoints MUST validate user ownership before data access
- No cross-user data leakage is permitted under any circumstance

**Rationale**: Fundamental security requirement for multi-tenant applications; protects user privacy.

### VIII. Responsive Design

The UI MUST be "Mobile-First," ensuring usability on all screen sizes.

**Non-Negotiable Rules**:
- Tailwind CSS MUST be used for styling
- Mobile layouts MUST be the default, with desktop enhancements via breakpoints
- All interactive elements MUST be touch-friendly (minimum 44px tap targets)

**Rationale**: Majority of users access web applications on mobile devices; mobile-first ensures broad accessibility.

### IX. RESTful Integrity

All backend communication MUST follow standard HTTP methods and REST conventions.

**Non-Negotiable Rules**:
- GET for reading data (idempotent, no side effects)
- POST for creating resources
- PUT/PATCH for updating resources
- DELETE for removing resources
- Appropriate HTTP status codes MUST be returned

**Rationale**: RESTful APIs are predictable, cacheable, and widely understood; improves API usability.

## Technical Standards

### Database Safety

All interactions with Neon Postgres MUST use an ORM or safe query builders to prevent SQL injection.

**Non-Negotiable Rules**:
- Raw SQL queries are PROHIBITED unless explicitly justified and reviewed
- ORM (e.g., SQLAlchemy, Prisma) or parameterized queries MUST be used
- Database migrations MUST be version-controlled
- Connection pooling MUST be configured for production

**Rationale**: SQL injection remains a top security vulnerability; ORM abstractions provide safety by default.

### Authentication

User sessions MUST be managed exclusively through Better Auth.

**Non-Negotiable Rules**:
- No custom authentication implementations
- Session tokens MUST be securely stored (HTTP-only cookies)
- Password hashing MUST use industry-standard algorithms
- All authenticated routes MUST verify session validity

**Rationale**: Authentication is security-critical; using established libraries reduces vulnerability risk.

### API Documentation

Every endpoint MUST be typed and self-documenting.

**Non-Negotiable Rules**:
- FastAPI's automatic Swagger/OpenAPI generation MUST be enabled
- Request and response models MUST be defined with Pydantic
- API versioning strategy MUST be documented
- Error responses MUST follow consistent schema

**Rationale**: Self-documenting APIs reduce integration friction and improve developer experience.

## UI/UX Standards

**Web Consistency**: Web interface MUST provide clear, intuitive user experience.

**Non-Negotiable Rules**:
- Success and error states MUST be visually distinct
- Loading states MUST be indicated for async operations
- Form validation errors MUST be displayed inline
- Navigation MUST be consistent across all pages

**CLI Consistency** (Phase 1 compatibility): Console output MUST be clear, using consistent headers and success/error indicators.

**Rationale**: Users rely on visual feedback for operation confirmation; consistency reduces cognitive load.

## Governance

**Constitution Supersedes All Practices**: This constitution is the authoritative source for development standards. Conflicts with other documents MUST be resolved in favor of the constitution.

**Amendment Procedure**:
1. Proposed changes MUST be documented with rationale
2. Changes MUST be reviewed for impact on existing artifacts
3. Version number MUST be incremented per semantic versioning:
   - MAJOR: Backward-incompatible principle changes, new phases, or architecture shifts
   - MINOR: New principles or material expansions within current phase
   - PATCH: Clarifications and non-semantic refinements

**Compliance Review**:
- All PRs/reviews MUST verify constitution compliance
- Violations MUST be documented and justified if unavoidable
- Use `CLAUDE.md` for runtime development guidance

**Version**: 2.0.0 | **Ratified**: 2025-12-21 | **Last Amended**: 2025-12-21
